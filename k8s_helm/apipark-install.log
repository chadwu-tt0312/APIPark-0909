NAME: apipark
LAST DEPLOYED: Wed Oct 15 18:16:06 2025
NAMESPACE: default
STATUS: pending-install
REVISION: 1
TEST SUITE: None
USER-SUPPLIED VALUES:
{}

COMPUTED VALUES:
affinity: {}
apinto:
  enabled: true
  image:
    pullPolicy: IfNotPresent
    repository: eolinker/apinto-gateway
    tag: 0.22.11
  persistence:
    enabled: true
    size: 5Gi
  resources:
    limits:
      cpu: 500m
      memory: 1Gi
    requests:
      cpu: 250m
      memory: 512Mi
  service:
    ports:
      admin:
        port: 9400
        targetPort: 9400
      http:
        nodePort: 31289
        port: 8099
        targetPort: 8099
      metrics:
        port: 9401
        targetPort: 9401
    type: NodePort
apipark:
  enabled: true
  env:
    ADMIN_PASSWORD: aToh0eag
    ERROR_DIR: work/logs
    ERROR_EXPIRE: 7d
    ERROR_FILE_NAME: error.log
    ERROR_LOG_LEVEL: info
    ERROR_PERIOD: day
    InfluxdbToken: dQ9>fK6&gJ
    Init: "true"
    MYSQL_DB: apipark
    MYSQL_IP: apipark-mysql
    MYSQL_PORT: "3306"
    MYSQL_PWD: "123456"
    MYSQL_USER_NAME: root
    REDIS_ADDR: apipark-redis:6379
    REDIS_PWD: "123456"
  image:
    pullPolicy: IfNotPresent
    repository: chadwu/apipark
    tag: v1.9.5-beta-1015
  replicaCount: 1
  resources:
    limits:
      cpu: 1000m
      memory: 4Gi
    requests:
      cpu: 500m
      memory: 1Gi
  service:
    nodePort: 31288
    port: 8288
    targetPort: 8288
    type: NodePort
global:
  imagePullSecrets: []
  imageRegistry: ""
  persistence:
    accessMode: ReadWriteOnce
    size: 50Gi
    storageClass: standard
grafana:
  auth:
    anonymousEnabled: true
    anonymousOrgRole: Admin
  enabled: true
  image:
    pullPolicy: IfNotPresent
    repository: grafana/grafana
    tag: 11.3.2
  persistence:
    enabled: true
    size: 5Gi
  resources:
    limits:
      cpu: 500m
      memory: 1Gi
    requests:
      cpu: 250m
      memory: 512Mi
  service:
    nodePort: 31300
    port: 3000
    targetPort: 3000
    type: NodePort
influxdb:
  auth:
    bucket: apinto
    org: apipark
    password: Key123qaz
    token: dQ9>fK6&gJ
    username: admin
  enabled: true
  image:
    pullPolicy: IfNotPresent
    repository: influxdb
    tag: 2.7.1
  persistence:
    size: 20Gi
  resources:
    limits:
      cpu: 500m
      memory: 1Gi
    requests:
      cpu: 250m
      memory: 512Mi
  service:
    port: 8086
    type: ClusterIP
ingress:
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /$1
    nginx.ingress.kubernetes.io/ssl-redirect: "false"
  className: nginx
  enabled: false
  hosts:
  - host: apipark.local
    paths:
    - path: /apinto/(.+)
      pathType: ImplementationSpecific
      service:
        name: apipark-apinto
        port: 8099
    - path: /
      pathType: Prefix
      service:
        name: apipark
        port: 8288
  nodePorts:
    http: 31288
  tls: []
loki:
  enabled: true
  image:
    pullPolicy: IfNotPresent
    repository: grafana/loki
    tag: 3.2.1
  persistence:
    size: 20Gi
  resources:
    limits:
      cpu: 500m
      memory: 1Gi
    requests:
      cpu: 250m
      memory: 512Mi
  service:
    port: 3100
    type: ClusterIP
mysql:
  auth:
    database: apipark
    password: "123456"
    rootPassword: "123456"
    username: root
  enabled: true
  image:
    pullPolicy: IfNotPresent
    repository: mysql
    tag: "8.0"
  persistence:
    size: 10Gi
  resources:
    limits:
      cpu: 500m
      memory: 1Gi
    requests:
      cpu: 250m
      memory: 512Mi
  service:
    nodePort: 31306
    port: 3306
    targetPort: 3306
    type: NodePort
nodeSelector: {}
nsq:
  enabled: true
  image:
    pullPolicy: IfNotPresent
    repository: nsqio/nsq
    tag: v1.3.0
  resources:
    limits:
      cpu: 250m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 256Mi
  service:
    ports:
      http:
        port: 4151
      tcp:
        port: 4150
    type: ClusterIP
redis:
  auth:
    password: "123456"
  enabled: true
  image:
    pullPolicy: IfNotPresent
    repository: redis
    tag: 7.2.4
  persistence:
    enabled: true
    size: 5Gi
  resources:
    limits:
      cpu: 250m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 256Mi
  service:
    port: 6379
    type: ClusterIP
serviceAccount:
  annotations: {}
  create: true
  name: ""
tolerations: []

HOOKS:
MANIFEST:
---
# Source: apipark/templates/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: apipark
  labels:
    helm.sh/chart: apipark-1.9.5-beta
    app.kubernetes.io/name: apipark
    app.kubernetes.io/instance: apipark
    app.kubernetes.io/version: "1.9.5-beta"
    app.kubernetes.io/managed-by: Helm
---
# Source: apipark/templates/secret.yaml
apiVersion: v1
kind: Secret
metadata:
  name: apipark-secret
  labels:
    helm.sh/chart: apipark-1.9.5-beta
    app.kubernetes.io/name: apipark
    app.kubernetes.io/instance: apipark
    app.kubernetes.io/version: "1.9.5-beta"
    app.kubernetes.io/managed-by: Helm
type: Opaque
data:
  # MySQL passwords
  mysql-root-password: "MTIzNDU2"
  mysql-password: "MTIzNDU2"
  
  # Redis password
  redis-password: "MTIzNDU2"
  
  # InfluxDB credentials
  influxdb-username: "YWRtaW4="
  influxdb-password: "S2V5MTIzcWF6"
  influxdb-token: "ZFE5PmZLNiZnSg=="
  
  # APIPark admin password
  apipark-admin-password: "YVRvaDBlYWc="
---
# Source: apipark/templates/apinto-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: apipark-apinto-config
  labels:
    helm.sh/chart: apipark-1.9.5-beta
    app.kubernetes.io/name: apipark
    app.kubernetes.io/instance: apipark
    app.kubernetes.io/version: "1.9.5-beta"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: apinto
data: 
  config.yml: |
    version: 2
    client:
      listen_urls: # open api 服務的監聽位址
        - http://0.0.0.0:9400
    gateway:
      # advertise_urls: # 轉送服務的廣播位址
      #   - http://127.0.0.1:9400
      listen_urls: # 轉送服務的監聽位址
        - https://0.0.0.0:8099
        - http://0.0.0.0:8099
    peer: # 集群間節點通訊設定資訊
      listen_urls: # 節點監聽位址
        - http://0.0.0.0:9401

  apinto.yml: |
    # 資料檔案放置目錄
    data_dir: /var/lib/apinto
    # pid檔案放置位址
    pid_dir: /var/run/apinto/
    # 日誌放置目錄
    log_dir: /var/log/apinto
    # socket放置目錄
    socket_dir: /tmp/apinto
    # apinto運行設定位址
    config: /etc/apinto/config.yml
    # 擴充倉庫目錄
    extends_dir: /var/lib/apinto/extenders/
    # 錯誤日誌檔名
    error_log_name: error.log
    # 錯誤日誌等級，日誌等級可以劃分為：debug，info，warn，error，panic五個等級，預設等級為error
    error_log_level: debug
    # 錯誤日誌過期時間，預設單位為天，d|天，h|小時
    error_log_expire: 7d
    # 錯誤日誌切割週期，僅支援day、hour
    error_log_period: day
---
# Source: apipark/templates/grafana-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: apipark-grafana-config
  labels:
    helm.sh/chart: apipark-1.9.5-beta
    app.kubernetes.io/name: apipark
    app.kubernetes.io/instance: apipark
    app.kubernetes.io/version: "1.9.5-beta"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: grafana
data:
  grafana-datasource.yaml: |
    apiVersion: 1
    datasources:
      - name: Loki
        type: loki
        access: proxy
        url: http://apipark-loki:3100
---
# Source: apipark/templates/loki-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: apipark-loki-config
  labels:
    helm.sh/chart: apipark-1.9.5-beta
    app.kubernetes.io/name: apipark
    app.kubernetes.io/instance: apipark
    app.kubernetes.io/version: "1.9.5-beta"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: loki
data:
  loki-config.yaml: |
    auth_enabled: false

    server:
      http_listen_port: 3100
      grpc_listen_port: 9096

    common:
      instance_addr: 127.0.0.1
      path_prefix: /tmp/loki
      storage:
        filesystem:
          chunks_directory: /tmp/loki/chunks
          rules_directory: /tmp/loki/rules
      replication_factor: 1
      ring:
        kvstore:
          store: inmemory

    query_range:
      results_cache:
        cache:
          embedded_cache:
            enabled: true
            max_size_mb: 100

    schema_config:
      configs:
        - from: 2025-10-14
          store: tsdb
          object_store: filesystem
          schema: v13
          index:
            prefix: index_
            period: 24h

    limits_config:
      max_query_length: 90d

    ruler:
      alertmanager_url: http://localhost:9093

    table_manager:
      retention_period: 90d
---
# Source: apipark/templates/grafana-pvc.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: apipark-grafana-pvc
  labels:
    helm.sh/chart: apipark-1.9.5-beta
    app.kubernetes.io/name: apipark
    app.kubernetes.io/instance: apipark
    app.kubernetes.io/version: "1.9.5-beta"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: grafana
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 5Gi
  storageClassName: standard
---
# Source: apipark/templates/redis-pvc.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: apipark-redis-pvc
  labels:
    helm.sh/chart: apipark-1.9.5-beta
    app.kubernetes.io/name: apipark
    app.kubernetes.io/instance: apipark
    app.kubernetes.io/version: "1.9.5-beta"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: redis
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 5Gi
  storageClassName: standard
---
# Source: apipark/templates/apinto-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: apipark-apinto
  labels:
    helm.sh/chart: apipark-1.9.5-beta
    app.kubernetes.io/name: apipark
    app.kubernetes.io/instance: apipark
    app.kubernetes.io/version: "1.9.5-beta"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: apinto
    app.kubernetes.io/group: apipark-ingress-backend
spec:
  type: NodePort
  ports:
    - name: http
      port: 8099
      targetPort: 8099
      protocol: TCP
      nodePort: 31289
    - name: admin
      port: 9400
      targetPort: 9400
      protocol: TCP
      nodePort: 
    - name: metrics
      port: 9401
      targetPort: 9401
      protocol: TCP
      nodePort: 
  selector:
    app.kubernetes.io/name: apipark
    app.kubernetes.io/instance: apipark
    app.kubernetes.io/component: apinto
---
# Source: apipark/templates/apipark-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: apipark
  labels:
    helm.sh/chart: apipark-1.9.5-beta
    app.kubernetes.io/name: apipark
    app.kubernetes.io/instance: apipark
    app.kubernetes.io/version: "1.9.5-beta"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: apipark
    app.kubernetes.io/group: apipark-ingress-backend
spec:
  type: NodePort
  ports:
    - port: 8288
      targetPort: 8288
      protocol: TCP
      name: http
      nodePort: 31288
  selector:
    app.kubernetes.io/name: apipark
    app.kubernetes.io/instance: apipark
    app.kubernetes.io/component: apipark
---
# Source: apipark/templates/grafana-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: apipark-grafana
  labels:
    helm.sh/chart: apipark-1.9.5-beta
    app.kubernetes.io/name: apipark
    app.kubernetes.io/instance: apipark
    app.kubernetes.io/version: "1.9.5-beta"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: grafana
spec:
  type: NodePort
  ports:
    - port: 3000
      targetPort: 3000
      protocol: TCP
      name: grafana
      nodePort: 31300
  selector:
    app.kubernetes.io/name: apipark
    app.kubernetes.io/instance: apipark
    app.kubernetes.io/component: grafana
---
# Source: apipark/templates/influxdb-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: apipark-influxdb
  labels:
    helm.sh/chart: apipark-1.9.5-beta
    app.kubernetes.io/name: apipark
    app.kubernetes.io/instance: apipark
    app.kubernetes.io/version: "1.9.5-beta"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: influxdb
spec:
  type: ClusterIP
  ports:
    - port: 8086
      protocol: TCP
      name: influxdb
  selector:
    app.kubernetes.io/name: apipark
    app.kubernetes.io/instance: apipark
    app.kubernetes.io/component: influxdb
---
# Source: apipark/templates/loki-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: apipark-loki
  labels:
    helm.sh/chart: apipark-1.9.5-beta
    app.kubernetes.io/name: apipark
    app.kubernetes.io/instance: apipark
    app.kubernetes.io/version: "1.9.5-beta"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: loki
spec:
  type: ClusterIP
  ports:
    - port: 3100
      protocol: TCP
      name: loki
  selector:
    app.kubernetes.io/name: apipark
    app.kubernetes.io/instance: apipark
    app.kubernetes.io/component: loki
---
# Source: apipark/templates/mysql-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: apipark-mysql
  labels:
    helm.sh/chart: apipark-1.9.5-beta
    app.kubernetes.io/name: apipark
    app.kubernetes.io/instance: apipark
    app.kubernetes.io/version: "1.9.5-beta"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: mysql
spec:
  type: NodePort
  ports:
    - port: 3306
      targetPort: 3306
      protocol: TCP
      name: mysql
      nodePort: 31306
  selector:
    app.kubernetes.io/name: apipark
    app.kubernetes.io/instance: apipark
    app.kubernetes.io/component: mysql
---
# Source: apipark/templates/nsq-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: apipark-nsq
  labels:
    helm.sh/chart: apipark-1.9.5-beta
    app.kubernetes.io/name: apipark
    app.kubernetes.io/instance: apipark
    app.kubernetes.io/version: "1.9.5-beta"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: nsq
spec:
  type: ClusterIP
  ports:
    - name: tcp
      port: 4150
      protocol: TCP
    - name: http
      port: 4151
      protocol: TCP
  selector:
    app.kubernetes.io/name: apipark
    app.kubernetes.io/instance: apipark
    app.kubernetes.io/component: nsq
---
# Source: apipark/templates/redis-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: apipark-redis
  labels:
    helm.sh/chart: apipark-1.9.5-beta
    app.kubernetes.io/name: apipark
    app.kubernetes.io/instance: apipark
    app.kubernetes.io/version: "1.9.5-beta"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: redis
spec:
  type: ClusterIP
  ports:
    - port: 6379
      protocol: TCP
      name: redis
  selector:
    app.kubernetes.io/name: apipark
    app.kubernetes.io/instance: apipark
    app.kubernetes.io/component: redis
---
# Source: apipark/templates/apipark-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: apipark
  labels:
    helm.sh/chart: apipark-1.9.5-beta
    app.kubernetes.io/name: apipark
    app.kubernetes.io/instance: apipark
    app.kubernetes.io/version: "1.9.5-beta"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: apipark
    app.kubernetes.io/group: apipark-ingress-backend
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: apipark
      app.kubernetes.io/instance: apipark
      app.kubernetes.io/component: apipark
      app.kubernetes.io/group: apipark-ingress-backend
  template:
    metadata:
      labels:
        app.kubernetes.io/name: apipark
        app.kubernetes.io/instance: apipark
        app.kubernetes.io/component: apipark
        app.kubernetes.io/group: apipark-ingress-backend
    spec:
      initContainers:
        - name: wait-mysql
          image: "busybox"
          imagePullPolicy: IfNotPresent
          command: ['sh', '-c', 'until nc -z apipark-mysql 3306; do echo waiting for mysql; sleep 2; done;']
        - name: wait-redis
          image: "busybox"
          imagePullPolicy: IfNotPresent
          command: ['sh', '-c', 'until nc -z apipark-redis 6379; do echo waiting for redis; sleep 2; done;']
        - name: wait-influxdb
          image: "busybox"
          imagePullPolicy: IfNotPresent
          command: ['sh', '-c', 'until nc -z apipark-influxdb 8086; do echo waiting for redis; sleep 2; done;']
        - name: wait-apinto
          image: "busybox"
          imagePullPolicy: IfNotPresent
          command: ['sh', '-c', 'until nc -z apipark-apinto 9400; do echo waiting for redis; sleep 2; done;']
      # serviceAccountName: apipark
      containers:
        - name: apipark
          image: "chadwu/apipark:v1.9.5-beta-1015"
          imagePullPolicy: IfNotPresent
          ports:
            - name: http
              containerPort: 8288
              protocol: TCP
          env:
            - name: MYSQL_USER_NAME
              value: "root"
            - name: MYSQL_PWD
              value: "123456"
            - name: MYSQL_IP
              value: "apipark-mysql"
            - name: MYSQL_PORT
              value: "3306"
            - name: MYSQL_DB
              value: "apipark"
            - name: ERROR_DIR
              value: "work/logs"
            - name: ERROR_FILE_NAME
              value: "error.log"
            - name: ERROR_LOG_LEVEL
              value: "info"
            - name: ERROR_EXPIRE
              value: "7d"
            - name: ERROR_PERIOD
              value: "day"
            - name: REDIS_ADDR
              value: "apipark-redis:6379"
            - name: REDIS_PWD
              value: "123456"
            - name: ADMIN_PASSWORD
              value: "aToh0eag"
            - name: Init
              value: "true"
            - name: InfluxdbToken
              value: "dQ9>fK6&gJ"
          resources:
            limits:
              cpu: 1000m
              memory: 4Gi
            requests:
              cpu: 500m
              memory: 1Gi
---
# Source: apipark/templates/grafana-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: apipark-grafana
  labels:
    helm.sh/chart: apipark-1.9.5-beta
    app.kubernetes.io/name: apipark
    app.kubernetes.io/instance: apipark
    app.kubernetes.io/version: "1.9.5-beta"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: grafana
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: apipark
      app.kubernetes.io/instance: apipark
      app.kubernetes.io/component: grafana
  template:
    metadata:
      labels:
        app.kubernetes.io/name: apipark
        app.kubernetes.io/instance: apipark
        app.kubernetes.io/component: grafana
    spec:
      containers:
        - name: grafana
          image: "grafana/grafana:11.3.2"
          imagePullPolicy: IfNotPresent
          command:
            - sh
            - -euc
            - |
              mkdir -p /etc/grafana/provisioning/datasources
              cp /etc/grafana-config/grafana-datasource.yaml /etc/grafana/provisioning/datasources/ds.yaml
              /run.sh
          ports:
            - name: grafana
              containerPort: 3000
              protocol: TCP
          env:
            - name: GF_PATHS_PROVISIONING
              value: "/etc/grafana/provisioning"
            - name: GF_AUTH_ANONYMOUS_ENABLED
              value: "true"
            - name: GF_AUTH_ANONYMOUS_ORG_ROLE
              value: "Admin"
          volumeMounts:
            - name: grafana-data
              mountPath: /var/lib/grafana
            - name: grafana-config
              mountPath: /etc/grafana-config
          resources:
            limits:
              cpu: 500m
              memory: 1Gi
            requests:
              cpu: 250m
              memory: 512Mi
      volumes:
        - name: grafana-data
          persistentVolumeClaim:
            claimName: apipark-grafana-pvc
        - name: grafana-config
          configMap:
            name: apipark-grafana-config
---
# Source: apipark/templates/nsq-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: apipark-nsq
  labels:
    helm.sh/chart: apipark-1.9.5-beta
    app.kubernetes.io/name: apipark
    app.kubernetes.io/instance: apipark
    app.kubernetes.io/version: "1.9.5-beta"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: nsq
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: apipark
      app.kubernetes.io/instance: apipark
      app.kubernetes.io/component: nsq
  template:
    metadata:
      labels:
        app.kubernetes.io/name: apipark
        app.kubernetes.io/instance: apipark
        app.kubernetes.io/component: nsq
    spec:
      containers:
        - name: nsq
          image: "nsqio/nsq:v1.3.0"
          imagePullPolicy: IfNotPresent
          command:
            - /nsqd
          ports:
            - name: tcp
              containerPort: 4150
              protocol: TCP
            - name: http
              containerPort: 4151
              protocol: TCP
          resources:
            limits:
              cpu: 250m
              memory: 512Mi
            requests:
              cpu: 100m
              memory: 256Mi
---
# Source: apipark/templates/redis-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: apipark-redis
  labels:
    helm.sh/chart: apipark-1.9.5-beta
    app.kubernetes.io/name: apipark
    app.kubernetes.io/instance: apipark
    app.kubernetes.io/version: "1.9.5-beta"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: redis
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: apipark
      app.kubernetes.io/instance: apipark
      app.kubernetes.io/component: redis
  template:
    metadata:
      labels:
        app.kubernetes.io/name: apipark
        app.kubernetes.io/instance: apipark
        app.kubernetes.io/component: redis
    spec:
      containers:
        - name: redis
          image: "redis:7.2.4"
          imagePullPolicy: IfNotPresent
          command:
            - redis-server
            - --protected-mode
            - "yes"
            - --logfile
            - redis.log
            - --appendonly
            - "no"
            - --port
            - "6379"
            - --requirepass
            - "123456"
          ports:
            - name: redis
              containerPort: 6379
              protocol: TCP
          volumeMounts:
            - name: redis-data
              mountPath: /data
          resources:
            limits:
              cpu: 250m
              memory: 512Mi
            requests:
              cpu: 100m
              memory: 256Mi
      volumes:
        - name: redis-data
          persistentVolumeClaim:
            claimName: apipark-redis-pvc
---
# Source: apipark/templates/apinto-statefulset.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: apipark-apinto
  labels:
    helm.sh/chart: apipark-1.9.5-beta
    app.kubernetes.io/name: apipark
    app.kubernetes.io/instance: apipark
    app.kubernetes.io/version: "1.9.5-beta"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: apinto
    app.kubernetes.io/group: apipark-ingress-backend
spec:
  serviceName: apipark-apinto
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: apipark
      app.kubernetes.io/instance: apipark
      app.kubernetes.io/component: apinto
      app.kubernetes.io/group: apipark-ingress-backend
  template:
    metadata:
      labels:
        app.kubernetes.io/name: apipark
        app.kubernetes.io/instance: apipark
        app.kubernetes.io/component: apinto
        app.kubernetes.io/group: apipark-ingress-backend
    spec:
      containers:
        - name: apinto
          image: "eolinker/apinto-gateway:0.22.11"
          imagePullPolicy: IfNotPresent
          ports:
            - name: http
              containerPort:  8099
              protocol: TCP
            - name: admin
              containerPort: 9400
              protocol: TCP
            - name: metrics
              containerPort: 9401
              protocol: TCP
          volumeMounts:
            - name: apinto-data
              mountPath: /var/lib/apinto
              subPath: data/
            - name: apinto-data
              mountPath: /var/log/apinto
              subPath: log/
            - name: apinto-config
              mountPath: /etc/apinto
          resources:
            limits:
              cpu: 500m
              memory: 1Gi
            requests:
              cpu: 250m
              memory: 512Mi
      volumes:
        - name: apinto-config
          configMap:
            name: apipark-apinto-config
  volumeClaimTemplates:
    - metadata:
        name: apinto-data
      spec:
        accessModes: 
        - ReadWriteOnce
        storageClassName: standard
        resources:
          requests:
            storage: 20Gi
---
# Source: apipark/templates/influxdb-statefulset.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: apipark-influxdb
  labels:
    helm.sh/chart: apipark-1.9.5-beta
    app.kubernetes.io/name: apipark
    app.kubernetes.io/instance: apipark
    app.kubernetes.io/version: "1.9.5-beta"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: influxdb
spec:
  serviceName: apipark-influxdb
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: apipark
      app.kubernetes.io/instance: apipark
      app.kubernetes.io/component: influxdb
  template:
    metadata:
      labels:
        app.kubernetes.io/name: apipark
        app.kubernetes.io/instance: apipark
        app.kubernetes.io/component: influxdb
    spec:
      # initContainers:
      #   - name: fix-permissions
      #     image: "busybox"
      #     command: ['sh', '-c', 'chown -R 1000:1000 /var/lib/influxdb2']
      #     volumeMounts:
      #       - name: influxdb-data
      #         mountPath: /var/lib/influxdb2
      #     securityContext:
      #       runAsUser: 0
      # securityContext:
      #   fsGroup: 1000
      #   runAsUser: 1000
      #   runAsGroup: 1000
      containers:
        - name: influxdb
          image: "influxdb:2.7.1"
          imagePullPolicy: IfNotPresent
          ports:
            - name: influxdb
              containerPort: 8086
              protocol: TCP
          env:
            - name: DOCKER_INFLUXDB_INIT_USERNAME
              value: "admin"
            - name: DOCKER_INFLUXDB_INIT_PASSWORD
              value: "Key123qaz"
            - name: DOCKER_INFLUXDB_INIT_ORG
              value: "apipark"
            - name: DOCKER_INFLUXDB_INIT_BUCKET
              value: "apinto"
            - name: DOCKER_INFLUXDB_INIT_ADMIN_TOKEN
              value: "dQ9>fK6&gJ"
            - name: DOCKER_INFLUXDB_INIT_MODE
              value: "setup"
            # - name: INFLUXD_BIND_ADDRESS
            #   value: ":8086"
          volumeMounts:
            - name: influxdb-data
              mountPath: /var/lib/influxdb2
            - name: influxdb-config
              mountPath: /etc/influxdb2
          # securityContext:
          #   runAsUser: 1000
          #   runAsGroup: 1000
          #   allowPrivilegeEscalation: false
          resources:
            limits:
              cpu: 500m
              memory: 1Gi
            requests:
              cpu: 250m
              memory: 512Mi
      volumes:
        - name: influxdb-config
          emptyDir: {}
  volumeClaimTemplates:
    - metadata:
        name: influxdb-data
      spec:
        accessModes: 
        - ReadWriteOnce
        storageClassName: standard
        resources:
          requests:
            storage: 20Gi
---
# Source: apipark/templates/loki-statefulset.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: apipark-loki
  labels:
    helm.sh/chart: apipark-1.9.5-beta
    app.kubernetes.io/name: apipark
    app.kubernetes.io/instance: apipark
    app.kubernetes.io/version: "1.9.5-beta"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: loki
spec:
  serviceName: apipark-loki
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: apipark
      app.kubernetes.io/instance: apipark
      app.kubernetes.io/component: loki
  template:
    metadata:
      labels:
        app.kubernetes.io/name: apipark
        app.kubernetes.io/instance: apipark
        app.kubernetes.io/component: loki
    spec:
      # securityContext:
      #   fsGroup: 10001
      #   runAsUser: 10001
      #   runAsGroup: 10001
      containers:
        - name: loki
          image: "grafana/loki:3.2.1"
          imagePullPolicy: IfNotPresent
          command:
            - /usr/bin/loki
            - -config.file=/etc/loki/loki-config.yaml
          ports:
            - name: loki
              containerPort: 3100
              protocol: TCP
          volumeMounts:
            - name: loki-data
              mountPath: /tmp/loki
            - name: loki-config
              mountPath: /etc/loki
          # securityContext:
          #   runAsUser: 10001
          #   runAsGroup: 10001
          #   allowPrivilegeEscalation: false
          #   readOnlyRootFilesystem: false
          resources:
            limits:
              cpu: 500m
              memory: 1Gi
            requests:
              cpu: 250m
              memory: 512Mi
      volumes:
        - name: loki-config
          configMap:
            name: apipark-loki-config
  volumeClaimTemplates:
    - metadata:
        name: loki-data
      spec:
        accessModes: 
        - ReadWriteOnce
        storageClassName: standard
        resources:
          requests:
            storage: 20Gi
---
# Source: apipark/templates/mysql-statefulset.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: apipark-mysql
  labels:
    helm.sh/chart: apipark-1.9.5-beta
    app.kubernetes.io/name: apipark
    app.kubernetes.io/instance: apipark
    app.kubernetes.io/version: "1.9.5-beta"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: mysql
spec:
  serviceName: apipark-mysql
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: apipark
      app.kubernetes.io/instance: apipark
      app.kubernetes.io/component: mysql
  template:
    metadata:
      labels:
        app.kubernetes.io/name: apipark
        app.kubernetes.io/instance: apipark
        app.kubernetes.io/component: mysql
    spec:
      containers:
        - name: mysql
          image: "mysql:8.0"
          imagePullPolicy: IfNotPresent
          args:
            - "--character-set-server=utf8mb4"
            - "--collation-server=utf8mb4_unicode_ci"
          ports:
            - name: mysql
              containerPort: 3306
              protocol: TCP
          env:
            - name: MYSQL_ROOT_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: apipark-secret
                  key: mysql-root-password
            - name: MYSQL_DATABASE
              value: "apipark"
          volumeMounts:
            - name: mysql-data
              mountPath: /var/lib/mysql
            # - name: mysql-init
            #   mountPath: /docker-entrypoint-initdb.d
          resources:
            limits:
              cpu: 500m
              memory: 1Gi
            requests:
              cpu: 250m
              memory: 512Mi          
      # volumes:
      #   - name: mysql-init
      #     configMap:
      #       name: apipark-config
  volumeClaimTemplates:
    - metadata:
        name: mysql-data
      spec:
        accessModes: 
        - ReadWriteOnce
        storageClassName: standard
        resources:
          requests:
            storage: 10Gi

